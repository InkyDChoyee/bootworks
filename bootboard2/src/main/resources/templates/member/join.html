<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>JOIN</title>
<link rel="stylesheet" th:href="@{/css/style.css}">
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
</head>
<body>
<header th:replace="~{layout/header :: header-fragment}" ></header>
	<div id="container">
		<h2 class="h2">Join</h2>
		<form th:action="@{/member/join}" method="post" class="form_join"
			th:object="${memberDTO}">
			<fieldset class="fs_join">
				<ul>
					<li><label for="memberId">ID</label> <input type="text"
						th:field="*{memberId}" id="memberId" placeholder="ID"
						onblur="checkEmail()">
						<p class="join_error" th:if="${#fields.hasErrors('memberId')}" 
						   th:errors="*{memberId}"></p>
					</li>
					<li><label for="password">Password</label> <input
						type="password" th:field="*{password}" id="password"
						placeholder="password">
						<p class="join_error" th:if="${#fields.hasErrors('password')}" 
						   th:errors="*{password}"></p>
					</li>
					<li><label for="name">Name</label> <input type="text"
						th:field="*{name}" id="name" placeholder="name">
						<p class="join_error" th:if="${#fields.hasErrors('name')}" 
						   th:errors="*{name}"></p>
					</li>
				</ul>
			</fieldset>
			<div class="joinBtn">
				<div class="join_btn">
					<input type="submit" value="SignUp"> 
				</div>
				<div class="other_btn">
					<a th:href="@{/}"><button class="btn_home" type="button">Home</button></a>
					<input id="other_btn_reset" type="reset" value="Cancel"> 
				</div>
			</div>
		</form>
	</div>
	<footer th:replace="~{layout/footer :: footer-fragment}"></footer>
<script>
	const checkEmail = ()=>{
		// alert("test...");
		let inputEmail = document.getElementById("memberEmail").value;
		console.log("입력된 이메일 = " + inputEmail);
		
		let checkResult = document.getElementById("check_result");
		
		$.ajax({
			type: "POST",
			url: "/member/check-email",
			data: {
				memberEmail: inputEmail  // 파라미터 = memberEmail
			},
			success: function(res){   // res => 결과 문자열이 반환됨
				console.log("성공: ", res);
				if(res=="OK"){
					checkResult.innerHTML = "사용 가능한 이메일입니다";
					checkResult.style.color = "#7e7";
				}else{  // res=="NO"
					checkResult.innerHTML = "이미 등록된 이메일입니다";
					checkResult.style.color = "#f99";
				}
			},
			error: function(err){
				console.log("실패: ", err);
			}
		});
	}
</script>

</body>
</html>